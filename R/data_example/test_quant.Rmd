---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
```{r}
source.all(path ="C:/Users/sire-cha/Documents/FunQuant/R")

library(GGally)
library(sp)
library(ggplot2)
library(gtools)
library(dplyr)
library(POT)
library(pracma)
library(DiceDesign)
library(randtoolbox)
library(abind)
library(miceadds)
library(waveslim)
library(foreach)
library(DiceKriging)
library(orthogonalsplinebasis)
library(viridis)
library(contoureR)
library(MASS)
library(reshape2)
library(RColorBrewer)
library(randomForest)
library(png)
library(ClimProjDiags)
library(dismo)
```
```{r}
#outputs = outputs[,, qui_nb]
#density_ratio = density_ratio[qui_nb]
gamma = gamma
distance_func = dist_L2
ncoeff_vec = c(500,1500,2500,3000)
npc =5
formula = ~1
design = doe_full[qui_nb,1:5]
covtype = "matern5_2"
coef.trend = NULL
coef.var = NULL
coef.cov = NULL
control = list(trace = 0)
nugget = 0.1
multistart=5
lower = rep(0.1,5)
```

```{r}
#source.all("C:/Users/sire-cha/Documents/FunQuant/R/GpOutput2D-main/GpOutput2D/R")



gamma_tt = quanti_proba$gamma
qui_nb = c(which(sum_depth[1:500] > 0))

source.all(path ="C:/Users/sire-cha/Documents/FunQuant/R")

pp = probas_loo(outputs = outputs[,, qui_nb], density_ratio = density_ratio[qui_nb],gamma = gamma_tt, distance_func = dist_L2, ncoeff_vec = c(500,1500,2500,3000), npc_vec=2:5,  formula = ~1, design = doe_full[qui_nb,1:5], covtype = "matern5_2", coef.trend = NULL, coef.var = NULL, coef.cov = NULL, control = list(trace = 0), nugget = 0.1,multistart=5, lower = rep(0.1,5), model_tuning = modd, bias = c(cste_bias, rep(0,4)))

probas_true = get_probas(density_ratio = density_ratio[qui_nb], outputs = outputs[,,qui_nb], gamma = gamma, distance_func = distance_func)
num_true = get_cell_numbers(outputs = outputs[,,qui_nb], gamma = gamma, distance_func = distance_func)

model = lapply(1:2, function(k){model_cv[[4]][[k]]})
    pred = sapply(1:2, function(i){leaveOneOut.km(model[[i]], type="UK")$mean})
fp = Fpca2d.Wavelets(outputs[,,qui_nb], wf = "d4", boundary = "periodic", J = 1, ncoeff = 2500, rank = 2)

    outputs_loo = inverse_Fpca2d(pred,fp)
    
num_pred = get_cell_numbers(outputs = outputs_loo, gamma = gamma, distance_func = distance_func)

sum(num_pred != num_true)
```

```{r}
outputs = outputs[,, qui_nb]
nb_folds = 7
density_ratio = density_ratio[qui_nb]
gamma = gamma_tt
distance_func = dist_L2
ncoeff_vec = c(500,1500,2500,3000)
npc_vec=2:5
formula = ~1
design = doe_full[qui_nb,1:5]
covtype = "matern5_2"
coef.trend = NULL
coef.var = NULL
coef.cov = NULL
control = list(trace = 0)
nugget = 0.1
multistart=5
lower = rep(0.1,5)
model_tuning = modd
bias = c(cste_bias, rep(0,4))
```

```{r}
pp_fold = probas_k_fold(outputs = outputs, nb_folds = 7, density_ratio = density_ratio,gamma = gamma_tt, distance_func = dist_L2, ncoeff_vec = c(500,1500,2500,3000), npc_vec=2:5,  formula = ~1, design = doe_full[qui_nb,1:5], covtype = "matern5_2", coef.trend = NULL, coef.var = NULL, coef.cov = NULL, control = list(trace = 0), nugget = 0.1,multistart=5, lower = rep(0.1,5), model_tuning = modd, bias = c(cste_bias, rep(0,4)))

test_pred = pp_fold$error
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
